{% extends 'dashboard_base.html' %}

{% block title %}Lista de Encuestas{% endblock %}

{% block sidebar_menu %}
<div class="menu-section">
    <h3>Encuestas</h3>
    <a href="{% url 'encuestas_web:lista' %}" class="menu-item active">
        <span>ðŸ“‹</span> Lista de Encuestas
    </a>
    <a href="{% url 'encuestas_web:crear' %}" class="menu-item">
        <span>âž•</span> Crear Encuesta
    </a>
</div>
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>GestiÃ³n de Encuestas</h1>
    <a href="{% url 'encuestas_web:crear' %}" class="btn-primary">âž• Nueva Encuesta</a>
</div>

<div class="card">
    <div class="card-header">
        <h2>Todas las Encuestas</h2>
    </div>
    <div class="card-body">
        <table>
            <thead>
                <tr>
                    <th>TÃ­tulo</th>
                    <th>Dirigida a</th>
                    <th>Estado</th>
                    <th>Fecha CreaciÃ³n</th>
                    <th>Respuestas</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for encuesta in encuestas %}
                <tr>
                    <td><strong>{{ encuesta.titulo }}</strong></td>
                    <td>{{ encuesta.get_dirigida_a_display }}</td>
                    <td>
                        {% if encuesta.estado == 'BORRADOR' %}
                            <span class="badge badge-warning">{{ encuesta.get_estado_display }}</span>
                        {% elif encuesta.estado == 'ACTIVA' %}
                            <span class="badge badge-success">{{ encuesta.get_estado_display }}</span>
                        {% else %}
                            <span class="badge badge-secondary">{{ encuesta.get_estado_display }}</span>
                        {% endif %}
                    </td>
                    <td>{{ encuesta.fecha_creacion|date:"d/m/Y" }}</td>
                    <td>
                        <strong>{{ encuesta.total_respuestas }}</strong> respuestas
                    </td>
                    <td>
                        {% if encuesta.estado == 'BORRADOR' %}
                            <a href="{% url 'encuestas_web:publicar' encuesta.pk %}" 
                               class="btn-action" 
                               onclick="return confirm('Â¿Publicar esta encuesta?')">
                                Publicar
                            </a>
                        {% elif encuesta.estado == 'ACTIVA' %}
                            <a href="{% url 'encuestas_web:cerrar' encuesta.pk %}" 
                               class="btn-action" 
                               style="background: #e74c3c;"
                               onclick="return confirm('Â¿Cerrar esta encuesta?')">
                                Cerrar
                            </a>
                        {% endif %}
                        
                        <a href="{% url 'encuestas_web:resultados' encuesta.pk %}" class="btn-action">
                            Ver Resultados
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6" style="text-align: center;">
                        No hay encuestas creadas. 
                        <a href="{% url 'encuestas_web:crear' %}">Crear la primera encuesta</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .badge-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
</style>
{% endblock %}
